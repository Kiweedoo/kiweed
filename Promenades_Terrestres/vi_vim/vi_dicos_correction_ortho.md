##### Status : en cours...


### Balade : langues et correction orthographique dans `vi`


#### <a name="sommaire">**Sommaire**</a>

##### &nbsp;&nbsp;&nbsp;[Objectifs](#objectifs)
##### &nbsp;&nbsp;&nbsp;[Préambule](#preambule)
<sub> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[Les Locales](#varloc)</sub>

<sub> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[`aspell`et les dictionnaires](#aspell)</sub>
##### &nbsp;&nbsp;&nbsp;[Installation des dictionnaires](#installdicos)
##### &nbsp;&nbsp;&nbsp;[Configuration de `vi`](#vimrc)
##### &nbsp;&nbsp;&nbsp;[Résumé](#resume)
##### &nbsp;&nbsp;&nbsp;[La minute HHGTTG : comment remodeler le concept même de l'espace-temps ?](#hhgttg)


---

### <a name="objectifs">Objectifs</a>

- Approcher raisonnablement de la planète Encodage...

- Connaître le dépôt des dictionnaires

- Installer les dictionnaires dont on a besoin

- Activer la langue choisie dans  fichier `~/.vimrc`

- Écrire les premières macros `vi` pour désactiver/activer la correction

- Utiliser les commandes de bases de correction.


&nbsp;

##### Ce qu'on y apprend au passage...

- [x] Visualiser et commencer à comprendre les Locales

- [x] Découvrir les rudiments de `spell`

- [x] Configurer son `~/.vimrc` 

- [x] Changer de langue pour, par exemple, rédiger en allemand

- [x] Écrire des macros `vi` en mode *commandes* **et** *insertion*

<sub>[(**sommaire ^**)](#sommaire)</sub>

---


### <a name="preambule">Préambule</a>

#### <a name="varloc">Les Locales</a>

La correction orthographique dans `vi` est basée sur la commande `aspell` (qui remplace `ispell` pour opérer sur des fichiers en
UTF-8).

Par défaut, `aspell` comprend la langue à utiliser en lisant une des variables locales, celle qui décrit le langage et
l'encodage des caractères (c'est-à-dire la façon dont ils sont représentés en machine, ie dans la mémoire).

Tapotons... Soit `prout.txt` un fichier texte :

><pre>
> cat <b>prout.txt</b>
> cessi est un fichier bouret de fotes
> sur pluzieurs lignes qu'ile nous faut corrigé
> Oups... Non, la correction grammaticale est 
> assurer par Grammalecte, un plugin en python,
> beaucoup plus lourd... Mais qui fait bien le djob ;)
></pre>

Le `man aspell` nous dit : `aspell -c fichier` ou `aspell check fichier` :

><pre>
> aspell -c prout.txt
> Erreur : No word lists can be found for the language "fr_FR".
></pre>

De ce message d'erreur, il faut comprendre qu'`aspell` n'a aucun dictionnaire pour le français (*no word list*)...

**Comment sait-il qu'il s'agit du français ?**

Lors de l'installation du système, tu dis... Français, Paris, clavier français, etc. 

Le tout premier choix, celui de la langue, est retenu dans **LA locale** (on en parle sous ces termes).

**Attention** : il n'y a qu'une seule *locale* sur un système, soit français, anglais, ou une autre langue.

><pre>
> cat <b>/etc/default/locale</b>
>#  File generated by update-locale
>LANG="fr_FR.UTF-8"
></pre>

En revanche, cette unique *locale* sert de base à de nombreuses autres variables, **attention**, certaines sont aussi baptisées
*locales*, par opposition aux variables d'environnement (futur article).

Nous parlons ici de **LA** Locale, qui représente une valeurs parmi un ensemble de *locales* supportée.

La notion de caractère affichée est une notion humaine. En machine, *on* a besoin de savoir combien d'octets sont nécessaires
pour dessiner ce caractère... Là encore, ce sera un article dédié... Car non seulement, il y a le nombre d'octets... et l'ordre
dans lequel ils sont enregistrés :wink:

Les *locales* supportées lors d'une installation sont quant à elles définies dans le fichier de la langue `fr` ou `en`&nbsp;:


><pre>
> ls -l <b>var/lib/locales/supported.d/fr</b>
> -rw-r--r-- 1 root root 90 2017-10-12-22:45 /var/lib/locales/supported.d/fr
> cat <b>/var/lib/locales/supported.d/fr</b>
> fr_LU.UTF-8 UTF-8
> fr_CH.UTF-8 UTF-8
> fr_CA.UTF-8 UTF-8
> fr_BE.UTF-8 UTF-8
> fr_FR.UTF-8 UTF-8
></pre>

Le choix de la langue au démarrage de l'installation est une chose, le choix de la ville en est une autre, tout aussi
importante.

La grammaire de *la locale* est toujours : `langue` `pays` `encodage`.

L'encodage est déterminé par le choix du clavier lors de l'installation.

**À retenir absolument** : oublier tous les encodages précédents... **toujours** utiliser UTF-8... 
<sub>Sauf si demande particulière ; par exemple nous avons vu qu'il restait dans `mysql` de 
l'encodage `iso-latin1-8859`, voir `latin-9` lors de l'ajout des caractères `€`,
`Œ`, le `æ` du *et cætera*, etc.
</sub>

**Important** Même si la langue est la même, la disposition clavier aussi, le choix de la ville, et donc du pays, 
n'est pas anodin.

Par exemple, les principales différences entre la Belgique (`fr_BE`), la France (`fr_FR`), et la Suisse (`fr_CH`) relèvent 
du **symbole monétaire** (CHF pour la Suisse), du **séparateur décimal** (`,` pour la France et la Belgique, `.` pour 
la Suisse), ou encore du **séparateur de milliers** (` ` pour la France, `.` pour la Belgique, et `'` pour la Suisse), etc.

Les spécificités des *locales* nationales sont ici : [liste des locales sur lh.2xlibre.net](https://lh.2xlibre.net/locales/)
(faire `ctrl-f` + `fr_`)


**IMPORTANT**(re) : **une seule _locale_** sur un système, **qui prévaut toujours** pour l'affichage quels que soient les encodages
applicatifs. 

<sub>Par exemple, *Java* représente en UTF-16 en interne, puis traduit dans la *locale* système pour l'affichage... De cela il faut également déduire qu'il n'y aucun moyen, à ma connaissance, du visualiser le mécanisme d'encodage interne et sa traduction...</sub>

Une seule *locale*... Mais qui est la base de bien d'autres...


Deux commandes pour différencier différents type de variables&nbsp;: <sub>(avant d'y consacrer un article particulier)</sub>

><pre>
> <b>locale</b>
> LANG=fr_FR.UTF-8
> LANGUAGE=fr_FR
> LC_CTYPE="fr_FR.UTF-8"
> LC_NUMERIC="fr_FR.UTF-8"
> LC_TIME="fr_FR.UTF-8"
> LC_COLLATE="fr_FR.UTF-8"
> LC_MONETARY="fr_FR.UTF-8"
> LC_MESSAGES="fr_FR.UTF-8"
> LC_PAPER="fr_FR.UTF-8"
> LC_NAME="fr_FR.UTF-8"
> LC_ADDRESS="fr_FR.UTF-8"
> LC_TELEPHONE="fr_FR.UTF-8"
> LC_MEASUREMENT="fr_FR.UTF-8"
> LC_IDENTIFICATION="fr_FR.UTF-8"
> LC_ALL=
></pre>

Pour faire simple, ce sont les variables destinées aux applications.

Par opposition aux variables d'environnement, destinées aux sous processus du *shell*, affichable avec la commande `env` dont on
filtre ici le résultat :

><pre>
> <b>env | grep FR</b>
> LANG=fr_FR.UTF-8
> GDM_LANG=fr_FR
> LANGUAGE=fr_FR
></pre>

<sub>*GDM* pour *Gnome Display Manager* qui gère l'affichage graphique et les sessions de connexion.</sub>

Ce sont les variables d'environnement (c'est-à-dire chargées dans l'environnement de travail lors de la connexion, avant celles
que l'utilisatrice.teur pourrait déclarer pour ses propres besoins).


<sub>[(**sommaire ^**)](#sommaire)</sub>

---

#### <a name="aspell">`aspell` et dictionnaires</a>

Il existe plusieurs correcteurs, les *spell checkers*, `aspell`, `hunspell`, et
quelques correcteurs grammaticaux... Notamment `vim-LanguageTool`, mais c'est un
plugin, alors que `vim` intègre par défaut l'utilisation de `aspell`
puisqu'installé par défaut sur les *unices*.

En outre, la correction intégrée dans `vi` est simple d'utilisation, ne demande
aucun plugin, et peut mettre être automatique...  Nous verrons par la suite quelles 
sont les/des solutions adaptées pour des fichiers `latex`...

Reprenons l'exemple avec le fichier `prout.txt`&nbsp;

><pre>
> aspell -c prout.txt
> Erreur : No word lists can be found for the language "fr_FR".
></pre>

À partir de la *locale*, `aspell` ne trouve aucun dictionnaire compatible.

<sub>[(**sommaire ^**)](#sommaire)</sub>

---


### <a name="installdicos">Installation des dictionnaires</a>



Les dictionnaires **présents** sont visibles :

><pre>
> <b>ls /usr/share/vim/vim80/spell</b>
> en.ascii.spl
> en.ascii.sug
> en.utf-8.spl
> en.utf-8.sug
> fr.utf-8.spl
> fr.utf-8.sug
> [...]
></pre>

Les fichiers `.spl` sont les *Spell Language*, les `.sug` pour les suggestions.
Pour un dictionnaire, les deux sont nécessaires.

Les dictionnaires **possibles** sont disponibles sur
[http://ftp.vim.org/vim/runtime/spell/](http://ftp.vim.org/vim/runtime/spell/)&nbsp;&nbsp;<sub>(ne
pas descendre dans `fr`, les dicos sont plus bas dans la page)</sub>


L'installation se passe en deux étapes :

- le téléchargement des dictionnaires choisis

- le déplacement par `sudo` dans le répertoire système dédié.

En plus de l'anglais, déjà présent, nous récupérons, le français et
l'allemand&nbsp;


><pre>
><b>cd ~/Téléchargements</b>
><b>wget</b> http://ftp.vim.org/vim/runtime/spell/fr.utf-8.spl
><b>wget</b> http://ftp.vim.org/vim/runtime/spell/fr.utf-8.sug
><b>wget</b> http://ftp.vim.org/vim/runtime/spell/de.utf-8.spl
><b>wget</b> http://ftp.vim.org/vim/runtime/spell/de.utf-8.sug
><b>ls -l</b> (pour voir qu'ils sont guillaume.guillaume)
><b>sudo mv \*.spl /usr/share/vim/vim80/spell</b>
><b>sudo mv \*.sug /usr/share/vim/vim80/spell</b>
>ls -l /usr/share/vim/vim80/spell... (pour voir root.root )
></pre>

Plus qu'à configurer `vi`.

<sub>[(**sommaire ^**)](#sommaire)</sub>

---

### <a name="vimrc">[Configuration de `vi`](#vimrc)</a>

La configuration de `vi`, de `vim` donc, se passe dans le fichier `~/.vimrc`.

C'est un fichier dont le nom commence par le caractère `.` : il n'apparaît pas
avec un simple `ls`, il faut utiliser l'option `-a` pour *all*
<sub>(sous-entendu, tous les fichiers, même ceux commençant par `.`)</sub>


><pre>
> <b>cd ~</b>
> <b>ls</b>
Bureau
Documents
[...]
Téléchargements
VirtualBox VMs
> <b>ls -a</b>
.
..
.bash_history
.bash_logout
.bashrc
Bureau
.config
.dbeaver4
.dbeaver-drivers
Documents
.gitconfig
.matlab
.vim
.viminfo
><b>.vimrc</b>
>[...]
></pre>

Il est probable, si nous ne l'avons pas déjà créé, qu'il n'existe pas… il faut
donc le créer sous ton répertoire de connexion &nbsp;:

- par défaut `vi` cherche un `.vimrc` dans le répertoire d'où tu le lances

- s'il en trouve un, il l'applique, sinon, il cherche le répertoire de connexion.
(ça permet d'avoir des configurations dédiées).

Voici celui que nous allons créé :

><pre>
> <b>cd ~</b>
> <b>cat .vimrc</b>
> set ai wm=4 ts=4 sw=4  tw=80
> au BufRead \*.txt setlocal spell spelllang=fr
> map <silent> <f6> "<esc>:silent setlocal spell! spelllang=en<cr>"
> map <silent> <f7> "<esc>:silent setlocal spell! spelllang=fr<cr>"
></pre>


Il s'enrichira au fur et à mesure :blink:

Donc création du fichier, ou ouverture, il sera vide si nouveau&nbsp;:

><pre>
><b>cd ~</b>
><b>vi .vimrc</b>
><b>a</b> pour passer en insertion sur la 1ère ligne
></pre>

Et tu tapes...

Les lignes commençant par un `"` (guillemet) en 1ère colonne (pas d'espace
avant) sont ignorées, ce sont les commentaires.

><pre>
>set ai wm=4 ts=4 sw=4 tw=80
>[ESC]:w[return] pour enregistrer sans quitter
><b>attention</b> il faudra repasser en insertion, par exemple en ouvrant une ligne
>dessous <b>o</b>, <b>O</b> ouvre au dessus de la position courante.
></pre>


- `set` : pour positionner les paramètres.
  - `ai` : *autoindent*
  - `wm` : *wrap margin*, ici 4 caractères, à, environ 4 caractères de la fin de
	ligne, retour à la ligne automatique.
  - `ts` : *tab stop*, le nombre de caractères de la tabulation, ici 4
  - `sw` : *shift width*, le décalage avec, en mode commande, `>>` vers la droite,
	ou `<<` vers la gauche, ici 4 pour être aligné sur la tabulation.
  - `tw` : *text width*, la longueur de la ligne, 80, pour être compatible avec la
	taille des lignes *mail*.

On continue...

><pre>
><b>o</b> pour ouvrir une ligne dessous
>au BufRead *.txt setlocal spell spelllang=fr
[ESC]:w[return]
></pre>

- `au` : *autocommand* en fonction des événements 
- `BufRead` : *Buffer Read*, le tampon mémoire de lecture
- `*.txt` : n'importe quoi suivi de l'extension `.txt`, présent dans *BufRead*
- `setlocal spell spelllang=fr`

En clair, on demande à `vim` d'activer la correction **uniquemenτ** lorsque le
*buffer* de lecture contient un fichier `.txt`, ce qui évite les surgacharges
dans les fichiers de développement. :wink:


On termine avec les macros pour désactiver/activer la correction.

Par désactivation, il faut comprendre, positionner une autre langue pour
laquelle nous n'avons rien précisé.

Attention :

- La touche F1 ne peut être utilisée (aide contextuelle), probablement d'autres
- Les touches F6 et F7 sont ok ici
- Les `<...>` sont **importants**,  ils valent pour des actions clavier, il faut
  les écrire dans le fichier `~/.vimrc`.

><pre>
>map &lt;silent&gt; &lt;f6&gt; "&lt;esc&gt;:silent setlocal spell! spelllang=en&lt;cr&gt;"
>map &lt;silent&gt; &lt;f7&gt; "&lt;esc&gt;:silent setlocal spell! spelllang=fr&lt;cr&gt;"
></pre>

  - `map` : c'est la commande d'association d'actions **en mode commande** (il
	faut être en mode commande pour que cela fonctionne)
  - `<silent>`: doit être le premier argument de la commande map ; comme son nom l'indique, pas d'écho de ce que l'on fait
  - `<f6>` : l'action d'appuyer sur F6, idem pour `<F7>`
  - `"`...`"` : toute l'action qui sera déroulée lors de la frappe de f6 ou f7
  - `<esc>` : la touche escape, pas nécessaire puisqu'on est censé être en mode
	commande... juste une habitude...
  - `:silent ...` : la commande que l'on taperait à l'invite en mode commande `:`, 
  sauf qu'on ne taperait pas `<silent>` 


<sub>[(**sommaire ^**)](#sommaire)</sub>



---

### <a name="resume">Résumé</a>


<sub>[(**sommaire ^**)](#sommaire)</sub>

<br>

---

#### <a name="hhgttg">La minute qui remodèle le concept même du temps et de l'espace</a>

<br>


<sub>(The HHGTTG, T3, Life, the Universe, and Everything, p.73 )</sub>

<sub>[(**sommaire ^**)](#sommaire)</sub>


:metal::alien::+1:
